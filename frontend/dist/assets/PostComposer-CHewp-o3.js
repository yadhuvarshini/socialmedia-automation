import{r,a as M,j as e,L as pe}from"./index-CqBQ_qF8.js";const U="blazly_composer_draft",we={linkedin:3e3,twitter:280,instagram:2200,facebook:63206,threads:500};function Se({onSuccess:z,integrations:R=[],selectedPlatform:u,onPlatformChange:Ce,theme:P="standard"}){var ce,de,me;const[j,L]=r.useState(()=>{try{const s=sessionStorage.getItem(U);if(s)return JSON.parse(s).content||""}catch{}return""}),[k,ue]=r.useState(()=>{try{const s=sessionStorage.getItem(U);if(s)return JSON.parse(s).scheduleAt||""}catch{}return""}),[d,ge]=r.useState(!0),[W,H]=r.useState([]),[m,O]=r.useState([]),[h,b]=r.useState(!1),[$,x]=r.useState(""),[J,q]=r.useState(""),[_,K]=r.useState(""),[A,Y]=r.useState(!1),[xe,f]=r.useState(!1),[_e,T]=r.useState(!1),[E,Z]=r.useState(""),[Q,X]=r.useState(!1),[fe,V]=r.useState(!1),[B,ee]=r.useState(""),[D,se]=r.useState(!1),[te,S]=r.useState(null),[F,ae]=r.useState(null),[i,I]=r.useState([]),[y,v]=r.useState("text"),N=r.useRef(null),re=m.length>0?Math.min(...m.map(s=>we[s]||5e3)):5e3,oe=j.trim().length,ie=oe>re,p=R.find(s=>s.platform===u&&s.isActive);r.useEffect(()=>{u&&(O([u]),P==="standard"&&f(!0))},[u,P]),r.useEffect(()=>{const s=setTimeout(()=>{try{sessionStorage.setItem(U,JSON.stringify({content:j,scheduleAt:k}))}catch{}},500);return()=>clearTimeout(s)},[j,k]);const G=u||m[0];r.useEffect(()=>{!d&&G?M(`/ai/best-times?platform=${G}`).then(s=>s.json()).then(s=>H(s.suggestions||[])).catch(()=>H([])):H([])},[d,G]);const ve={linkedin:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),facebook:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.791-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),twitter:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})}),instagram:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678a6.162 6.162 0 1 0 0 12.324 6.162 6.162 0 1 0 0-12.324zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405a1.441 1.441 0 1 1-2.88 0 1.441 1.441 0 0 1 2.88 0z"})})},le=async s=>{const t=s.target.files;if(!t||t.length===0)return;b(!0),x("");const o=[...i];try{for(const a of t){const l=new FormData;l.append("file",a);const g=await M("/upload",{method:"POST",body:l}),n=await g.json().catch(()=>({}));if(!g.ok||!n.url)throw new Error(n.error||"Upload failed");const C=n.url,c=a.type.startsWith("video/");o.push({type:c?"VIDEO":"IMAGE",imageUrl:c?null:C,videoUrl:c?C:null,preview:C,fileName:a.name})}I(o),o.length>1?v("carousel"):v(o[0].type==="IMAGE"?"image":"video"),f(!0)}catch(a){console.error("File upload error:",a),x("Failed to upload. Ensure backend is running and try again.")}finally{b(!1),N.current&&(N.current.value="")}},ne=s=>{if(s&&s.preventDefault(),!_)return;b(!0);const t=_.match(/\.(mp4|mov|avi|wmv)$|video|drive\.google|vimeo|youtube/i),o={type:t?"VIDEO":"IMAGE",imageUrl:t?null:_,videoUrl:t?_:null,preview:_,fileName:"URL Media"},a=[...i,o];I(a),a.length>1?v("carousel"):v(a[0].type==="IMAGE"?"image":"video"),K(""),Y(!1),f(!0),b(!1)},je=s=>{m.includes(s)?O(m.filter(t=>t!==s)):O([...m,s])},be=async()=>{if(E.trim()){X(!0);try{const s=await M("/ai/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topic:E,imagePrompt:"",platform:u||"linkedin"})}),t=await s.json();if(!s.ok)throw new Error(t.error||"AI generation failed");let o=t.content;t.hashtags&&t.hashtags.length>0&&(o+=`

`+t.hashtags.join(" ")),L(o),T(!1),Z("")}catch(s){alert("AI Error: "+s.message)}finally{X(!1)}}},ye=async()=>{const s=B.trim();se(!0);try{if(!s)return;const t=await M("/ai/generate-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:s})}),o=await t.json();if(!t.ok)throw new Error(o.error||"Image generation failed");const a=o.url,l={type:"IMAGE",imageUrl:a,videoUrl:null,preview:a,fileName:"AI Generated"};I(g=>[...g,l]),v(i.length>=1?"carousel":"image"),V(!1),ee("")}catch(t){alert("Image Error: "+t.message)}finally{se(!1)}},Ne=async s=>{s.preventDefault(),x(""),q("");const t=j.trim();if(y==="text"&&!t){x("Write something to post.");return}if(!d&&!k){x("Pick a date and time for scheduling.");return}if(m.length===0){x("Please select at least one platform.");return}b(!0),S(null);try{const o={content:t,platforms:m,mediaType:y,mediaItems:i.map(c=>({type:c.type,url:c.imageUrl||c.videoUrl})),status:d?"publishing":"scheduled",scheduledAt:d?null:new Date(k).toISOString()};let a="/posts",l={...o};y==="image"&&i.length>0?(a="/posts/image",l.imageUrl=i[0].imageUrl):y==="video"&&i.length>0?(a="/posts/video",l.videoUrl=i[0].videoUrl):y==="carousel"&&i.length>0&&(a="/posts/carousel");const g=await M(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),n=await g.json().catch(()=>({}));if(!g.ok){const c=n.error||n.details||n.message||(n.errors&&Array.isArray(n.errors)?n.errors.map(he=>he.error||he.message).join(". "):null)||`Request failed (${g.status})`;throw new Error(c)}q(d?"Post published successfully!":"Post scheduled successfully!");const C=n.platformUrls?Object.entries(n.platformUrls).filter(([,c])=>c):[];ae(C.length?C:null),L(""),I([]),v("text"),f(!1),S(null);try{sessionStorage.removeItem(U)}catch{}z==null||z()}catch(o){const a=o.message||"Failed to publish. Please try again.";x(a),S(a)}finally{b(!1)}},w=P==="linkedin"||u==="linkedin";return!xe&&w?e.jsxs("div",{className:"composer-trigger-bar",children:[e.jsxs("div",{className:"composer-trigger-bar__main",children:[e.jsx("img",{src:((ce=p==null?void 0:p.profile)==null?void 0:ce.profilePicture)||"/default-avatar.png",alt:"",className:"composer-trigger-bar__avatar"}),e.jsx("button",{className:"composer-trigger-bar__input",onClick:()=>f(!0),children:"Start a post"})]}),e.jsxs("div",{className:"composer-trigger-bar__actions",children:[e.jsxs("button",{className:"trigger-action",onClick:()=>{var s;f(!0),(s=N.current)==null||s.click()},children:[e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"#378fe9",children:[e.jsx("path",{d:"M19 4H5a3 3 0 00-3 3v10a3 3 0 003 3h14a3 3 0 003-3V7a3 3 0 00-3-3zm1 13a1 1 0 01-1 1H5a1 1 0 01-1-1V7a1 1 0 011-1h14a1 1 0 011 1v10z"}),e.jsx("circle",{cx:"8",cy:"10",r:"2"}),e.jsx("path",{d:"M16 9l-4 4-2-2-4 4v1h14v-4z"})]}),e.jsx("span",{children:"Media"})]}),e.jsxs("button",{className:"trigger-action",children:[e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"#5f9b41",children:[e.jsx("path",{d:"M19 4H5a3 3 0 00-3 3v10a3 3 0 003 3h14a3 3 0 003-3V7a3 3 0 00-3-3zm1 13a1 1 0 01-1 1H5a1 1 0 01-1-1V7a1 1 0 011-1h14a1 1 0 011 1v10z"}),e.jsx("path",{d:"M16 10.5l4-2v7l-4-2v-3zM7 9h7v2H7V9zm0 4h7v2H7v-2z"})]}),e.jsx("span",{children:"Video"})]}),e.jsxs("button",{className:"trigger-action",children:[e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"#c37d16",children:[e.jsx("path",{d:"M19 4H5a3 3 0 00-3 3v10a3 3 0 003 3h14a3 3 0 003-3V7a3 3 0 00-3-3zm1 13a1 1 0 01-1 1H5a1 1 0 01-1-1V7a1 1 0 011-1h14a1 1 0 011 1v10z"}),e.jsx("path",{d:"M9 14h6v2H9v-2zm0-4h6v2H9v-2zm0-4h6v2H9v-2zm0-4h6v2H9V6z"})]}),e.jsx("span",{children:"Article"})]})]}),e.jsx("input",{type:"file",ref:N,style:{display:"none"},onChange:le,accept:"image/*,video/*"})]}):e.jsxs(e.Fragment,{children:[h&&e.jsx("div",{className:"posting-overlay","aria-live":"polite",children:e.jsxs("div",{className:"posting-overlay__card posting-overlay__card--loading",children:[e.jsx(pe,{compact:!0}),e.jsxs("p",{className:"posting-overlay__hint",children:[d?"Publishing…":"Scheduling…"," Please wait."]})]})}),te&&!h&&e.jsx("div",{className:"posting-overlay posting-overlay--error",onClick:()=>S(null),children:e.jsxs("div",{className:"posting-overlay__card posting-overlay__card--error",onClick:s=>s.stopPropagation(),children:[e.jsx("p",{className:"posting-overlay__error-title",children:"Post failed"}),e.jsx("p",{className:"posting-overlay__error-msg",children:te}),e.jsx("button",{className:"posting-overlay__dismiss",onClick:()=>S(null),children:"Dismiss"})]})}),_e&&e.jsx("div",{className:"ai-modal-overlay",children:e.jsxs("div",{className:"ai-modal",children:[e.jsxs("h3",{children:[e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 2a10 10 0 1 0 10 10H12V2z"}),e.jsx("path",{d:"M12 2a10 10 0 0 1 10 10"}),e.jsx("path",{d:"M12 12 2.1 10.5"})]}),"Generate post with AI"]}),e.jsx("p",{className:"ai-modal__desc",children:"Describe your topic. AI writes the caption. Add images separately with the image button below."}),e.jsx("textarea",{placeholder:"Ex: A professional update about launching our new sustainability initiative...",value:E,onChange:s=>Z(s.target.value),autoFocus:!0,className:"ai-modal__textarea"}),e.jsxs("div",{className:"ai-modal__actions",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>T(!1),children:"Cancel"}),e.jsx("button",{className:"btn-primary-ai",onClick:be,disabled:Q||!E.trim(),children:Q?"Generating...":"Generate Post"})]})]})}),fe&&e.jsx("div",{className:"ai-modal-overlay",children:e.jsx("div",{className:"ai-modal ai-modal--image",children:D?e.jsx("div",{className:"ai-modal__loading",children:e.jsx(pe,{compact:!0,lightBg:!0})}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Generate image"}),e.jsx("p",{className:"ai-modal__desc",children:"Describe the image you want — your prompt is used exactly (e.g. mcp architecture diagram, modern office)."}),e.jsx("input",{type:"text",placeholder:"Ex: MCP architecture diagram, team collaboration, abstract gradient",value:B,onChange:s=>ee(s.target.value),className:"ai-modal__input",autoFocus:!0}),e.jsxs("div",{className:"ai-modal__actions",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>V(!1),disabled:D,children:"Cancel"}),e.jsx("button",{className:"btn-primary-ai",onClick:ye,disabled:D||!B.trim(),children:"Generate Image"})]})]})})}),e.jsxs("div",{className:`composer ${w?"composer--linkedin":""}`,children:[w&&e.jsxs("div",{className:"composer__modal-header",children:[e.jsx("h3",{children:"Create a post"}),e.jsx("button",{className:"close-btn",onClick:()=>f(!1),children:"×"})]}),!w&&!u&&e.jsxs("div",{className:"composer__header",children:[e.jsx("h2",{className:"composer__title",children:"Create Post"}),e.jsx("div",{className:"composer__platform-icons",children:R.filter(s=>s.isActive).map(s=>e.jsxs("button",{type:"button",className:`composer__platform-btn composer__platform-btn--${s.platform} ${m.includes(s.platform)?"composer__platform-btn--active":""}`,onClick:()=>je(s.platform),title:s.platform,children:[ve[s.platform]||s.platform,m.includes(s.platform)&&e.jsx("span",{className:"composer__platform-check",children:"✓"})]},s.platform))})]}),e.jsxs("form",{className:"composer__form",onSubmit:Ne,children:[e.jsxs("div",{className:"composer__main",children:[w&&e.jsxs("div",{className:"composer__user-info",children:[e.jsx("img",{src:((de=p==null?void 0:p.profile)==null?void 0:de.profilePicture)||"/default-avatar.png",alt:""}),e.jsxs("div",{children:[e.jsx("strong",{children:((me=p==null?void 0:p.profile)==null?void 0:me.name)||"User"}),e.jsx("span",{className:"visibility-badge",children:"Public"})]})]}),e.jsx("textarea",{className:"composer__textarea",placeholder:w?"What do you want to talk about?":"What's on your mind?",value:j,onChange:s=>L(s.target.value),disabled:h}),e.jsxs("div",{className:"composer__media-actions",children:[e.jsxs("button",{type:"button",className:"composer__action-btn",onClick:()=>{var s;return(s=N.current)==null?void 0:s.click()},disabled:h,children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("polyline",{points:"21 15 16 10 5 21"})]}),"Upload"]}),e.jsxs("button",{type:"button",className:"composer__action-btn composer__ai-btn",onClick:()=>T(!0),disabled:h,children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"})}),"AI Post"]}),e.jsxs("button",{type:"button",className:"composer__action-btn composer__image-btn",onClick:()=>V(!0),disabled:h,children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("path",{d:"m21 15-5-5L5 21"})]}),"AI Image"]}),e.jsxs("button",{type:"button",className:`composer__action-btn ${A?"composer__action-btn--active":""}`,onClick:()=>Y(!A),disabled:h,children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),e.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]}),"URL"]}),e.jsx("input",{type:"file",ref:N,style:{display:"none"},onChange:le,multiple:!0,accept:"image/*,video/*"})]}),(A||i.length>0)&&e.jsxs("div",{className:"composer__attachments-tray",children:[A&&e.jsxs("div",{className:"composer__url-bar",children:[e.jsx("input",{type:"text",className:"composer__url-field",placeholder:"Paste image/video URL...",value:_,onChange:s=>K(s.target.value),onKeyDown:s=>s.key==="Enter"&&ne(s),autoFocus:!0}),e.jsx("button",{type:"button",className:"composer__url-add",onClick:ne,disabled:!_,children:"Add"})]}),i.length>0&&e.jsx("div",{className:"composer__media-gallery",children:i.map((s,t)=>e.jsxs("div",{className:"composer__media-thumbnail composer__media-thumbnail--large",children:[s.type==="IMAGE"?e.jsxs("div",{className:"composer__img-wrap",children:[e.jsx("img",{src:s.imageUrl||s.preview,alt:"",onError:o=>{var l;o.target.onerror=null,o.target.style.display="none";const a=o.target.closest(".composer__img-wrap");(l=a==null?void 0:a.querySelector(".composer__img-failed"))==null||l.classList.add("composer__img-failed--show")}}),e.jsx("span",{className:"composer__img-failed",children:"Image failed to load"})]}):e.jsx("div",{className:"composer__video-icon",children:"▶"}),e.jsx("button",{type:"button",className:"composer__media-remove",onClick:()=>{const o=i.filter((a,l)=>l!==t);I(o),o.length===0&&v("text")},children:"×"})]},t))})]})]}),e.jsxs("div",{className:"composer__footer",children:[e.jsxs("div",{className:"composer__schedule",children:[e.jsxs("label",{className:"composer__toggle",children:[e.jsx("input",{type:"checkbox",checked:!d,onChange:()=>ge(!d)}),e.jsx("span",{className:"composer__toggle-label",children:"Schedule"})]}),!d&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"datetime-local",className:"composer__datetime",value:k,onChange:s=>ue(s.target.value),min:new Date().toISOString().slice(0,16)}),W.length>0&&e.jsxs("div",{className:"composer__best-times",children:[e.jsx("span",{className:"composer__best-times-label",children:"Suggested:"}),W.slice(0,3).map((s,t)=>e.jsx("span",{className:"composer__best-time-hint",children:s},t))]})]})]}),e.jsxs("div",{className:"composer__submit-area",children:[$&&e.jsx("p",{className:"composer__error",children:$}),J&&e.jsx("p",{className:"composer__success",children:J}),F&&F.length>0&&e.jsxs("div",{className:"composer__share-links",children:[F.map(([s,t])=>e.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"composer__share-link",children:["View on ",s]},s)),e.jsx("button",{type:"button",className:"composer__share-dismiss",onClick:()=>ae(null),"aria-label":"Close",children:"×"})]}),e.jsxs("div",{className:"composer__actions-row",children:[e.jsxs("span",{className:`composer__counter ${ie?"composer__counter--error":""}`,children:[oe," / ",re]}),e.jsx("button",{type:"submit",className:"composer__submit-btn",disabled:h||y==="text"&&!j.trim()||ie||m.length===0,children:h?"...":d?"Post":"Schedule"})]})]})]})]})]})]})}export{Se as default};
